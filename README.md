# aerokml
The DJI Aeroscope AS-P1800 with Crystal Sky tablet does not include capability to export logs, perform geospacial analysis, overlay data from multiple flights or perofrm any other advanced analysis. The only data export included with the solution is a screenshot functionality. Investigors and analysts may require these advanced capabilities while performing investigations and prepareing reports. Aerokml provides this functionality. 

![Title Picture](map.gif?raw=true)

# Introduction

Aerokml is a Python script to parse the Aeroscope SQLilte database and generate KMLs for each flight. Aerokml will generate multiple KML files per flight:

- **S/N_DJIModel_Flight#_flight.kml -** This is a KML file of waypoints of the UAS in flight, tagged with time of observance. This file can be imported in to Google Earth and animated for playback. 
- **S/N_DJIModel_Flight#_ls.kml -** This is a KML file of a line string the UAS in flight. All waypoints are connected by a blue line. This file can be imported in to Google Earth and animated for playback. 
- **S/N_DJIModel_Flight#_gcs.kml -** This is a KML file of waypoints of the location of the ground controller station (GCS), or controller, tagged with time of observance. This file can be imported in to Google Earth and animated for playback. 
- **S/N_DJIModel_Flight#_home.kml -** This is a KML file of waypoints of the home point, tagged with time of observance. This file can be imported in to Google Earth and animated for playback. Home point can be updated during flight, so there may be more than one home point. This can happen at the beginning of the flight, while the GNSS is refining its coordinates, or later, if the opeartor updates the home point. 

# Installation

Aerokml has one external dependency: simplekml. After cloning this repo, install simplekml. 

`python3 -m pip install -r requirements.txt`

# Usage

## Acquiring `dji_detect.db`

Aerokml will parse the sqlite database generated by the Aeroscope AS-P1800 with Crystal Sky tablet. The `dji_detect.db` database must be in copied from the Crystal Sky tablet, in order to generate the KML files. The following instructions will acquire the `dji_detect.db` file from the Crystal Sky tablet. The user should have a laptop with Android Debug Bridge (ADB) installed and operable. 

1. Power on the Crystal Sky Tablet. 
1. If the Crystal Sky is plugged in to the bottom-side of the AS-F1800, unplug the USB-A port from the bottom-side. 
1. Gently Pull the Crystal Sky tablet forward from the case to expose the micro USB on the bottom of the left side of the Crystal Sky tablet. 
1. Plug in the laptop with ADB to the Crystal Sky tablet via USB. 
1. Launch a terminal on the laptop and download the `dji_detect.db` from the Crystal Sky tablet. 
1. `adb pull /sdcard/DJI/com.dji.aeroscope/databases/dji_detect.db ./`
1. No further interaction is required with the Crystal Sky tablet. At this point the Crystal Sky can be unplugged from the laptop and the USB-A port should be plugged back in to the bottom-side of the AS-F1800. 


## Processing `dji_detect.db`
Aerokml must be pointed to the `dji_detect.db` file. By default, aerokml will output the KML files to the `kml` directory in the aerokml directory. The minimal vialbe command to process a file would be the following:

```
python3 aerokml.py --db /path/to/dji_detect.db
```

Below is the help screen for Aerokml, detailing the command line arguments. 

```
usage: aerokml.py [-h] [--db DB] [--sn SN] [--dir [DIR]]

optional arguments:
  -h, --help   show this help message and exit
  --db DB      Path to Aeroscope SQLite Database. This parameter is required.
  --sn SN      Exports logs to KML for the drone with this serial number. If no S/N sepcified, will process all
               drones.
  --dir [DIR]  Export KML files to this directory. by default, this is ./kml/. You must have write permissions to the
               specified directory. The directory must already exist.
```
